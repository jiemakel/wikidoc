var app;!function(t){"use strict";var e=angular.module("app",["http-auth-interceptor","ui.router","ui.bootstrap","ngPrettyJson"]);e.config(["$stateProvider","$urlRouterProvider",function(t,e){e.otherwise("/"),t.state("main",{url:"/",template:"<main></main>"})}])}(app||(app={}));var app;!function(t){"use strict";var e=function(){function t(t,e){this.$http=t,this.$sce=e,this.mainTitle="Vapaamuurarin hauta",this.images=[],this.related=[],this.edit=!1,this.requestLog=[],this.update()}return t.prototype.getTitles=function(t){var e=this;return this.$http.get("http://ldf.fi/corsproxy/fi.wikipedia.org/w/api.php?action=query&formatversion=2&generator=prefixsearch&gpslimit=10&prop=pageimages%7Cpageterms&piprop=thumbnail&pithumbsize=50&pilimit=10&redirects=&format=json",{params:{gpssearch:t}}).then(function(t){return e.requestLog=[t],t.data.query.pages.map(function(t){return{title:t.title,url:"http://fi.wikipedia.org/wiki/"+encodeURIComponent(t.title),thumbnail:t.thumbnail?t.thumbnail.source:void 0}})})},t.prototype.update=function(){var t=this;this.requestLog=[],this.edit=!1,this.images=[],this.$http.get("http://ldf.fi/corsproxy/fi.wikipedia.org/w/api.php?format=json&action=query&prop=extracts&exintro=&explaintext=",{params:{titles:this.mainTitle}}).then(function(e){t.requestLog.push(e);var i=e.data.query.pages;for(var n in i)t.description=i[n].extract}),this.$http.get("http://ldf.fi/corsproxy/fi.wikipedia.org/w/api.php?action=query&list=search&utf8=&format=json",{params:{srsearch:'"'+this.mainTitle+'"'}}).then(function(e){t.requestLog.push(e),t.related=e.data.query.search.map(function(e){return{title:e.title,description:t.$sce.trustAsHtml(e.snippet),url:"http://fi.wikipedia.org/wiki/"+encodeURIComponent(e.title)}})}),this.$http.get("http://ldf.fi/corsproxy/fi.wikipedia.org/w/api.php?action=query&formatversion=2&generator=prefixsearch&gpslimit=10&prop=pageimages%7Cpageterms&piprop=thumbnail&pithumbsize=500&pilimit=10&redirects=&format=json",{params:{gpssearch:this.mainTitle}}).then(function(e){t.requestLog.push(e),t.mainImage=e.data.query.pages[0].thumbnail.source}),this.$http.get("http://api.finna.fi/api/v1/search?type=AllFields&sort=relevance%2Cid%20asc&page=1&limit=20&prettyPrint=true&lng=fi",{params:{lookfor:this.mainTitle}}).then(function(e){return t.images=t.images.concat(e.data.records.filter(function(t){return t.images&&!t.images.isEmpty}).map(function(i){return t.requestLog.push(e),{title:i.title,url:"http://api.finna.fi"+i.images[0],link:"http://finna.fi/Record/"+encodeURIComponent(i.id),source:"Finna"}}))}),this.$http.get("https://api.flickr.com/services/rest/?method=flickr.photos.search&api_key=bd6f075a5409b85d4ac2fe27aad1b182&format=json&nojsoncallback=1",{params:{text:this.mainTitle}}).then(function(e){return t.images=t.images.concat(e.data.photos.photo.map(function(i){return t.requestLog.push(e),{title:i.title,url:"https://farm"+i.farm+".staticflickr.com/"+i.server+"/"+i.id+"_"+i.secret+".jpg",link:"https://www.flickr.com/photos/"+i.owner+"/"+i.id,source:"Flickr"}}))})},t}();angular.module("app").controller("MainComponentController",["$http","$sce",function(){return new(Function.prototype.bind.apply(e,[null].concat(Array.prototype.slice.apply(arguments))))}]),t.MainComponentController=e;var i=function(){function t(){this.controller="MainComponentController",this.templateUrl="components/main.html"}return t}();angular.module("app").component("main",new i),t.MainComponent=i}(app||(app={})),function(t){try{t=angular.module("app")}catch(e){t=angular.module("app",[])}t.run(["$templateCache",function(t){t.put("components/main.html",'\n<script type="text/ng-template" id="customTemplate.html"><a><img ng-src="{{match.model.thumbnail}}"/><span ng-bind-html="match.label | uibTypeaheadHighlight:query"></span></a></script>\n<div class="container">\n  <h4 ng-show="!$ctrl.edit" ng-click="$ctrl.edit = !$ctrl.edit">{{$ctrl.mainTitle}}</h4>\n  <div class="form-group has-feedback">\n    <input class="form-control" ng-show="$ctrl.edit" ng-model="$ctrl.mainTitle" ng-change="$ctrl.updateSearch()" uib-typeahead="page.title for page in $ctrl.getTitles($viewValue)" typeahead-loading="loadingTitles" typeahead-no-results="noResults" typeahead-template-url="customTemplate.html" typeahead-on-select="$ctrl.update()"/><span class="glyphicon glyphicon-refresh form-control-feedback" ng-show="loadingTitles"></span><i class="glyphicon glyphicon-remove" ng-show="noResults">No results</i>\n  </div>\n  <h4>Images</h4><img ng-src="{{$ctrl.mainImage}}"/>\n  <div class="well">{{$ctrl.description}}</div>\n  <div class="row">\n    <div class="col-md-4" ng-repeat="image in $ctrl.images track by $index">\n      <div class="thumbnail">\n        <button class="btn-xs" ng-click="$ctrl.images.splice($index, 1)"><i class="glyphicon glyphicon-remove"></i></button><a ng-href="{{image.link}}"><img class="img-rounded img-thumbnail" ng-src="{{image.url}}"/></a>\n        <div class="caption">{{image.title}} ({{image.source}})</div>\n      </div>\n    </div>\n  </div>\n  <h4>Related Wikipedia articles</h4>\n  <div class="row">\n    <div class="col-md-4" ng-repeat="related in $ctrl.related track by $index">\n      <button class="btn-xs" ng-click="$ctrl.related.splice($index, 1)"><i class="glyphicon glyphicon-remove"></i></button>\n      <h4><a ng-href="{{related.url}}">{{related.title}}</a></h4>\n      <div ng-bind-html="related.description"></div>\n    </div>\n  </div>\n  <button class="btn-xs" ng-show="!showLog" ng-click="showLog=!showLog"><i class="glyphicon glyphicon-chevron-down"></i></button>\n  <div ng-show="showLog">\n    <button class="btn-xs" ng-click="showLog=!showLog"><i class="glyphicon glyphicon-chevron-up"></i></button>\n    <div class="well" ng-repeat="request in $ctrl.requestLog track by $index">\n      <h5>Request</h5>\n      <pre pretty-json="request.config"></pre>\n      <h5>Response</h5>\n      <pre pretty-json="request.data" style="overflow-y:scroll;max-height:200px;"></pre>\n    </div>\n  </div>\n</div>')}])}();